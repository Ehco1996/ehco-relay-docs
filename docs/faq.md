## 故障排查

-   新增的规则通常需要一段时间来生效，如果你无法连接到目标服务器，请等待一段时间再尝试。

-   请保证你使用的客户端和中转节点的网络连接正常。

## 隧道协议对比

以下表格总结了每种隧道协议的优缺点，帮助您做出更适合您需求的选择：

| 隧道协议                   | 优点                                                       | 缺点                                                           |
| -------------------------- | ---------------------------------------------------------- | -------------------------------------------------------------- |
| 直接转发(多路复用)         | TCP 级别的多路复用，延迟低，适合本身已经有过一层加密的流量 | 开销较大，当链路上对单条 tcp 有 QOS 时，可能会跑不满带宽。     |
| WebSocket                  | 支持在标准 HTTP 端口上通信，易于穿越防火墙。               | 相比直接连接，性能略有损失。                                   |
| WebSocket Secure           | 增加了加密，提高数据传输安全性。                           | 相比 WebSocket，可能会有额外的性能损失。                       |
| WebSocket Secure(多路复用) | 结合了 WebSocket Secure 的安全性和多路复用的高效传输。     | 相比单一协议，实现更复杂，可能需要更多的客户端和服务器端资源。 |

总的来说:

-   如果您需要更高的性能，可以选择 WebSocket
-   如果您需要更高的安全性，可以选择 WebSocket Secure。
-   如果您需要兼顾安全性和低延迟，可以选择 WebSocket Secure(多路复用)。
-   如果您的流量本身已经有过一层加密，且需要低延迟，可以选择直接转发(多路复用)。
-   更多隧道协议正在开发中，敬请期待。

## Apple M1 上的 ehco 性能基准测试

本次基准测试使用 iperf3 工具在 Apple M1 芯片上评估了 ehco 在不同转发模式下的性能。测试包括直接转发和通过不同类型的隧道（ws、wss、mwss）转发。以下是具体的测试命令和结果。

### 测试命令

首先，启动 iperf3 作为服务器监听在端口 5201：

```sh
iperf3 -s
```

接下来，通过不同的命令启动 ehco 以测试各种转发模式的性能。

#### 直接转发

```sh
ehco -l 0.0.0.0:1234 -r 0.0.0.0:5201
```

#### 通过 ws 隧道转发

```sh
ehco -l 0.0.0.0:1235 -r ws://0.0.0.0:1236 -tt ws
ehco -l 0.0.0.0:1236 -lt ws -r 0.0.0.0:5201
```

#### 通过 wss 隧道转发

```sh
ehco -l 0.0.0.0:1235 -r wss://0.0.0.0:1236 -tt wss
ehco -l 0.0.0.0:1236 -lt wss -r 0.0.0.0:5201
```

#### 通过 mwss 隧道转发

```sh
ehco -l 0.0.0.0:1237 -r wss://0.0.0.0:1238 -tt mwss
ehco -l 0.0.0.0:1238 -lt mwss -r 0.0.0.0:5201
```

#### 通过 mtcp 隧道转发

```sh
ehco -l 0.0.0.0:1237 -r wss://0.0.0.0:1238 -tt mtcp
ehco -l 0.0.0.0:1238 -lt mtcp -r 0.0.0.0:5201
```

### 性能基准测试结果

测试结果如下表所示，展示了在不同转发模式下，通过 TCP 和 UDP 协议的性能表现。

| 类型 | 原始 (raw)     | 直接转发 (relay raw) | ws 隧道 (relay ws) | wss 隧道 (relay wss) | mwss 隧道 (relay mwss) | mtcp 隧道 (relay mtcp) |
| ---- | -------------- | -------------------- | ------------------ | -------------------- | ---------------------- | ---------------------- |
| TCP  | 123 Gbits/sec  | 55 Gbits/sec         | 41 Gbits/sec       | 10 Gbits/sec         | 5.78 Gbits/sec         | 22.2 Gbits/sec         |
| UDP  | 14.5 Gbits/sec | 3.3 Gbits/sec        | 直接转发           | 直接转发             | 直接转发               | 直接转发               |

### 分析

从测试结果可以看出，直接转发的性能最高，而通过隧道转发（特别是通过加密的 wss 和 mwss 隧道）时，性能有所下降。这是因为隧道转发涉及到额外的加密解密过程和封包解包操作，这些都会增加 CPU 负载和延迟，从而影响传输速率。

特别是，mwss 隧道在减少延迟方面有所优化，但其传输速率相比 wss 隧道有明显下降。这种权衡是设计上的选择，取决于用户对速度和延迟的不同需求。

这些测试结果为 ehco 用户提供了在不同场景下选择合适转发模式的参考依据。

## 没有合适的节点

您可能无法在本站找到满足特定需求的入口/出口节点。为此，我们提供了一种解决方案：您通过 [添加节点](node/manage.md) 功能，将自己的节点托管到系统中。

请放心，托管节点的过程完全在用户侧进行，我们完全不接触您的机器，我们重视您的数据安全，并承诺不会收集任何敏感数据。

隧道转发为您的数据传输提供了灵活且安全的解决方案，无论是在数据安全性、传输效率，还是网络环境适应性方面，都能满足您的需求。我们鼓励用户探索不同的隧道协议，找到最适合自己场景的配置。

## 托管节点如果开启了 web 功能后，会获得什么？

-   内嵌的 Connection Manager，可以查看当前连接状态和流量统计。
-   内嵌的 Config Manager，可以查看当前节点的规则列表，热更新规则。
-   内嵌的 Metrics，可以查看当前节点的性能指标。ehco 还内嵌了 node_exporter，可以查看节点的系统指标。
-   更多功能正在开发中，敬请期待。

## 联系我们

-   如果您在使用过程中遇到问题，可以通过 Telegram 联系我：[Ehco](https://t.me/Ehco1996)。
